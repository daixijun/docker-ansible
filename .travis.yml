language: bash

env:
  global:
    - DOCKER_IMAGE=daixijun1990/ansible
  matrix:
    - VERSION=v2.5.15 EXTRA_TAGS="v2.5"
    - VERSION=v2.6.15 EXTRA_TAGS="v2.6"
    - VERSION=v2.7.9 EXTRA_TAGS="v2;v2.7;latest"

services:
  - docker

before_script:
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"

script:
  - docker build --build-arg version=$VERSION --tag $DOCKER_IMAGE:$VERSION .
  - docker push $DOCKER_IMAGE:$VERSION
  - |
    for tag in ${EXTRA_TAGS//;/$'\n'}
      docker tag $DOCKER_IMAGE:$VERSION $DOCKER_IMAGE:$tag
      docker push $DOCKER_IMAGE:$tag
    fi
